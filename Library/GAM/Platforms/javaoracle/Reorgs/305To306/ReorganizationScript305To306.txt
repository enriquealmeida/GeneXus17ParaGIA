ALTER TABLE "Session" ADD (SesOauthScope  NVARCHAR2(1024) , SesOauthTokenExpires  NUMERIC(6) , SesOauthTokenMaxRenew  NUMERIC(4) , SesAutTypeName  NCHAR(60) , SesExtToken2  NVARCHAR2(1024) )

ALTER TABLE SessionHistory ADD (SesHisOauthScope  NVARCHAR2(1024) , SesHisOauthTokenExpires  NUMERIC(6) , SesHisOauthTokenMaxRenew  NUMERIC(4) , SesHisAppTokenExp  DATE , SesHisDeviceId  NCHAR(40) , SesHisRefreshToken  NCHAR(40) , SesHisAppId  NUMERIC(12) , SesHisExtToken2  NVARCHAR2(1024) )

ALTER TABLE Application ADD (AppCliLocalLoginURL  NVARCHAR2(1024) , AppCliAllowGetUserAdditionalDa  NUMERIC(1) , AppCliAllowGetUserRoles  NUMERIC(1) , AppCliAllowRemoteAuth  NUMERIC(1) )
INSERT INTO Repository (RepId, RepVer, RepUpg, RepDefAutTypeName, RepUserActType, RepUserActTimeOut, RepDefSecPolId, RepGenAud, RepUserRemMeTimeOut, RepGenSesSta, RepUserChrMinLog, RepGUID, RepCanRegUser, RepUserRemMeType, RepGiveAnoSes, RepAnoUserGUID, RepDefRoleId, RepCreDate, RepCreUser, RepUpdDate, RepUpdUser, RepNameSpace, RepUserRecPwdKeyTimeOut, RepUserReqPwd, RepUserReqEmail, RepUserReqFirstName, RepUserReqLastName, RepUserReqBir, RepUserReqGen, RepUserReqPhone, RepUserReqAddress, RepUserReqCity, RepUserReqState, RepUserReqCountry, RepUserReqPostCode, RepUserReqLng, RepUserReqTimeZone, RepUserReqPhoto, RepUserAttLogLockUser, RepUserAttLogLockSession, RepDsc, RepUserEmailSecAdm, RepUserTimeToUnblock, RepName, RepUserEmailUnique, RepAllowOauthAccess, RepUserIdentification, RepKeepSesOnlyOriIP, RepUserSessionCacheTimeout, RepAnoUserSDRoleId) SELECT DISTINCT RepId, N' ', N' ', NULL, N'A', 36, NULL, N'None', 0, N'None', 3, N' ', 0, N' ', 0, NULL, NULL, to_date( '1-1-1 0:0:0', 'YYYY-MM-DD HH24:MI:SS'), N' ', TO_DATE('0001-01-01', 'YYYY-MM-DD'), N' ', N' ', 120, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 10, NULL, NULL, 30, N' ', 0, 1, N'name', 0, 60, NULL FROM Application T WHERE NOT EXISTS (SELECT 1 FROM Repository WHERE RepId = T.RepId)
INSERT INTO Application (RepId, AppId, AppName, AppGUID, AppVer, AppComName, AppTypeId, AppParAppId, AppDsc, AppCopyright, AppOrder, AppRetMnuOptWithoutPrm, AppCurEnvId, AppBaseAppId, AppCreDate, AppCreUser, AppUpdDate, AppUpdUser, AppIsBaseApplication, AppCliId, AppCliSecret, AppCliUserGUID, AppCliImageURL, AppCliSiteURL, AppCliSiteDomain, AppCliRevoked, AppType, AppCliEncKey, AppCliDefPrmGUID, AppAccessReqPrm, AppCliAccessUniqueByUser, AppCliAutoRegAnomymousUser, AppCliAllowRemoteAuth, AppCliAllowGetUserRoles, AppCliAllowGetUserAdditionalDa, AppCliLocalLoginURL) SELECT DISTINCT RepId, AppId, AppName, AppGUID, AppVer, AppComName, AppTypeId, AppParAppId, AppDsc, AppCopyright, AppOrder, AppRetMnuOptWithoutPrm, AppCurEnvId, AppBaseAppId, AppCreDate, AppCreUser, AppUpdDate, AppUpdUser, AppIsBaseApplication, AppCliId, AppCliSecret, AppCliUserGUID, AppCliImageURL, AppCliSiteURL, AppCliSiteDomain, AppCliRevoked, AppType, AppCliEncKey, AppCliDefPrmGUID, AppAccessReqPrm, AppCliAccessUniqueByUser, AppCliAutoRegAnomymousUser, NULL, NULL, NULL, NULL FROM Application T WHERE NOT EXISTS (SELECT 1 FROM Application WHERE RepId = T.RepId AND AppId = T.AppId)
INSERT INTO AppEnvironment (RepId, AppId, AppEnvId, AppEnvOrder, AppEnvGUID, AppEnvSrvHost, AppEnvSrvPort, AppEnvSrvVirDir, AppEnvSrvHttps, AppEnvSrvPgmPac, AppEnvSrvPgmExt, AppEnvName, AppEnvCreDate, AppEnvCreUser, AppEnvUpdDate, AppEnvUpdUser) SELECT DISTINCT RepId, AppId, AppCurEnvId, 0, ' ', ' ', NULL, NULL, 0, NULL, NULL, NULL, NULL, NULL, TO_DATE('0001-01-01', 'YYYY-MM-DD'), NULL FROM Application T WHERE NOT EXISTS (SELECT 1 FROM AppEnvironment WHERE RepId = T.RepId AND AppId = T.AppId AND AppEnvId = T.AppCurEnvId) AND (NOT AppCurEnvId IS NULL )
ALTER TABLE Application MODIFY AppCliSecret  NCHAR(120)
CREATE INDEX IAPPLICATIONENV ON Application (RepId ,AppId ,AppCurEnvId )

CREATE TABLE UserMemRoleProp (UserGUID  NCHAR(40) NOT NULL , RepId  NUMERIC(9) NOT NULL , UserMemRoleRoleId  NUMERIC(12) NOT NULL , UserMemRolePropId  NCHAR(60) NOT NULL , UserMemRolePropToken  NCHAR(40) NOT NULL , UserMemRolePropValue  NVARCHAR2(400) NOT NULL , PRIMARY KEY(UserGUID, RepId, UserMemRoleRoleId, UserMemRolePropId, UserMemRolePropToken))

CREATE TABLE UserMemAppRoleProp (UserGUID  NCHAR(40) NOT NULL , RepId  NUMERIC(9) NOT NULL , UserMemAppRoleAppId  NUMERIC(12) NOT NULL , UserMemAppRoleRoleId  NUMERIC(12) NOT NULL , UserMemAppRolePropId  NCHAR(60) NOT NULL , UserMemAppRolePropToken  NCHAR(40) NOT NULL , UserMemAppRolePropValue  NVARCHAR2(400) NOT NULL , PRIMARY KEY(UserGUID, RepId, UserMemAppRoleAppId, UserMemAppRoleRoleId, UserMemAppRolePropId, UserMemAppRolePropToken))

CREATE TABLE SecurityPolicyProp (RepId  NUMERIC(9) NOT NULL , SecPolId  NUMERIC(9) NOT NULL , SecPolPropId  NCHAR(60) NOT NULL , SecPolPropToken  NCHAR(40) NOT NULL , SecPolPropValue  NVARCHAR2(400) NOT NULL , PRIMARY KEY(RepId, SecPolId, SecPolPropId, SecPolPropToken))

DROP INDEX IUSERMEMAPPROLE1
CREATE INDEX IUSERMEMAPPROLEAPP ON UserMemAppRole (RepId ,UserMemAppRoleAppId )
CREATE INDEX IUSERMEMAPPROLEROLE ON UserMemAppRole (RepId ,UserMemAppRoleRoleId )

ALTER TABLE SessionHistoryHisLogAtt RENAME TO SessionHistoryLogAtt

UPDATE SysPar SET SysParVal='3.0.6' WHERE SysParId=N'GAMVersion'

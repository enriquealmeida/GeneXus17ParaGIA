<!DOCTYPE html>
<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="./images/WikiTheme2.css"/>
<link rel="stylesheet" type="text/css" href="./images/bootstrap.min.css"/>
<title>StoreManager external object</title>
</head>
<body bgcolor="#FFFFFF" style="display: block;margin: 8px;"><span id="W0004BODY" class="WikiBody"><table border=0 width=100%><tr><td><div align="right"><FONT face=Verdana size=2><a href =https://wiki.genexus.com/commwiki/wiki?31320,, target=_"blank">Newest Version</a></FONT></div></td></tr></table><h1 class="WikiName">StoreManager external object</h1>
<!--StoreManager external object--><table class="TableWikiBody" id="tblwikibody"><tbody><tr><td><p>The StoreManager external object is a component allows you to manage <a href="https://wiki.genexus.com/commwiki/wiki?20003,," target="_blank">In-App Purchases</a> in your applications.</p>

<p><div style="background-color: rgb(255,255,204);border-left: 6.0px solid rgb(255,255,0);margin-bottom: 15.0px;padding: 4.0px 12.0px;"><strong>Warning</strong>:  This document applies for <a href="https://wiki.genexus.com/commwiki/wiki?33278,," target="_blank">GeneXus 15 Upgrade 3</a>. Those developers who use previous upgrades must refer to the previous version of this document.</div>
</p>

<table border="0" cellpadding="1" cellspacing="1" style="border-collapse: collapse;">
	<tbody>
		<tr>
			<td style="vertical-align: top;"><img src="./images/39654.png" id="39654" class="WikiImage"/></td>
			<td style="vertical-align: top;"><img src="./images/39655.png" id="39655" class="WikiImage"/></td>
		</tr>
	</tbody>
</table>

<h2><a id="Properties" class="HashLink" href="#Properties">Properties</a></h2>

<h3><a id="CanMakePurchases+property" class="HashLink" href="#CanMakePurchases+property">CanMakePurchases property</a></h3>

<p>Allows you to know if the device can make purchases (True) or not (False). For example, it can be used to restrict purchases if the device does not admit them.</p>

<h2><a id="Methods" class="HashLink" href="#Methods">Methods</a></h2>

<h3><a id="GetProducts+method" class="HashLink" href="#GetProducts+method">GetProducts method</a></h3>

<p>Given a list of products, returns a collection with detailed information about them. Useful to get the title in the user's local language and the price in the user's local currency.</p>

<table border="0" cellpadding="1" cellspacing="1">
	<tbody>
		<tr>
			<td style="vertical-align: top;"><strong>Return value </strong></td>
			<td style="vertical-align: top;">StoreProduct</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"><strong>Parameters</strong></td>
			<td style="vertical-align: top;">ProductIdentifications:Collection(<a href="6778.html">VarChar(100)</a>)</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"> </td>
			<td style="vertical-align: top;"> </td>
		</tr>
	</tbody>
</table>

<h3><a id="PurchaseProduct+method" class="HashLink" href="#PurchaseProduct+method">PurchaseProduct method</a></h3>

<p>Sends the purchase request of the given product to the platform's In-App Purchases store.</p>

<p><div style="background-color: rgb(242,242,242);border-left: 6.0px solid rgb(128,128,128);margin-bottom: 15.0px;padding: 4.0px 12.0px;"><b>Note</b>:  On Android, the Quantity parameter only accepts the value 1 because every product can be <em>purchased</em> or <em>not purchased</em>.</div>
</p>

<table border="0" cellpadding="1" cellspacing="1">
	<tbody>
		<tr>
			<td style="vertical-align: top;"><strong>Return value </strong></td>
			<td style="vertical-align: top;">StoreProduct</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"><strong>Parameters</strong></td>
			<td style="vertical-align: top;">ProductIdentifier:<a href="6778.html">VarChar(100)</a>, [ , Quantity:<a href="6793.html">Numeric(8.0)</a> ]</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"> </td>
			<td style="vertical-align: top;"> </td>
		</tr>
	</tbody>
</table>

<h3><a id="GetPurchases+method" class="HashLink" href="#GetPurchases+method">GetPurchases method</a></h3>

<p>Gets a list of information of the user's purchased products.</p>

<table border="0" cellpadding="1" cellspacing="1">
	<tbody>
		<tr>
			<td style="vertical-align: top;"><strong>Return value </strong></td>
			<td style="vertical-align: top;">PurchasesInformation</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"><strong>Parameters</strong></td>
			<td style="vertical-align: top;">None</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"> </td>
			<td style="vertical-align: top;"> </td>
		</tr>
	</tbody>
</table>

<h3><a id="ConsumeProduct+method" class="HashLink" href="#ConsumeProduct+method">ConsumeProduct method</a></h3>

<p>Consumes a product for which the user has a purchase and returns the success status.</p>

<table border="0" cellpadding="1" cellspacing="1">
	<tbody>
		<tr>
			<td style="vertical-align: top;"><strong>Return value </strong></td>
			<td style="vertical-align: top;"><a href="4374.html">Boolean</a></td>
		</tr>
		<tr>
			<td style="vertical-align: top;"><strong>Parameters</strong></td>
			<td style="vertical-align: top;">ProductIdentifier:<a href="6778.html">VarChar(100)</a></td>
		</tr>
		<tr>
			<td style="vertical-align: top;"> </td>
			<td style="vertical-align: top;"> </td>
		</tr>
	</tbody>
</table>

<h3><a id="RestorePurchases+method" class="HashLink" href="#RestorePurchases+method">RestorePurchases method</a></h3>

<p>Only available for iOS. Restore the purchases through the device.</p>

<table border="0" cellpadding="1" cellspacing="1">
	<tbody>
		<tr>
			<td style="vertical-align: top;"><strong>Return value </strong></td>
			<td style="vertical-align: top;">PurchasesInformation</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"><strong>Parameters</strong></td>
			<td style="vertical-align: top;">None</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"> </td>
			<td style="vertical-align: top;"> </td>
		</tr>
	</tbody>
</table>

<h2><a id="Events" class="HashLink" href="#Events">Events</a></h2>

<h3><a id="PurchaseStateChange+event" class="HashLink" href="#PurchaseStateChange+event">PurchaseStateChange event</a></h3>

<p>This event only applies to iOS. When a purchase is made, this event will be called indefinitely if the Handled parameter is set to False until the developer sets it to True. The reason for this behavior is that iOS does not persist the information of a purchase (as Android does) when the product type is consumable. A typical scenario might occur when the app crashes without the response of the store platform after a transaction request. In such case, the purchase can be processed when the app is opened again. <strong>It's the responsibility of the developers to persist in their systems the user status in relation to the billings</strong> (in replacement of <em>EnableProduct </em>or <em>DisableProduct</em> deprecated methods --- see the previous version of this document for details).</p>

<table border="0" cellpadding="1" cellspacing="1">
	<tbody>
		<tr>
			<td style="vertical-align: top;"><strong>Input</strong></td>
			<td style="vertical-align: top;">Purchase:PurchaseResult, PurchaseState:StorePurchaseState, Handled:<a href="4374.html">Boolean</a></td>
		</tr>
		<tr>
			<td style="vertical-align: top;"><strong>Output </strong></td>
			<td style="vertical-align: top;">None</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"> </td>
			<td style="vertical-align: top;"> </td>
		</tr>
	</tbody>
</table>

<h2><a id="Domains" class="HashLink" href="#Domains">Domains</a></h2>

<h3><a id="StorePurchaseState+domain" class="HashLink" href="#StorePurchaseState+domain">StorePurchaseState domain</a></h3>

<p>Set of state values of a purchase. Only applies for iOS.</p>

<table border="0" cellpadding="1" cellspacing="1" style="border-collapse: collapse;">
	<tbody>
		<tr>
			<td style="vertical-align: top;"><strong>Purchased </strong></td>
			<td style="vertical-align: top;">When the purchase was successful.</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"><strong>Failed</strong></td>
			<td style="vertical-align: top;">When the purchase fails.</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"><strong>Restored</strong></td>
			<td style="vertical-align: top;">When the purchases are restored.</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"><strong>Deferred</strong></td>
			<td style="vertical-align: top;">When the purchase depends on parental control.</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"> </td>
			<td style="vertical-align: top;"> </td>
		</tr>
	</tbody>
</table>

<h3><a id="StorePurchasePlatform+domain" class="HashLink" href="#StorePurchasePlatform+domain">StorePurchasePlatform domain</a></h3>

<p>Store platforms where the purchase was made.</p>

<table border="0" cellpadding="1" cellspacing="1" style="border-collapse: collapse;">
	<tbody>
		<tr>
			<td style="vertical-align: top;"><strong>GooglePlay </strong></td>
			<td style="vertical-align: top;">Google Play (for Android) as store platform.</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"><strong>iTunes</strong></td>
			<td style="vertical-align: top;">iTunes (for iOS) as store platform.</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"> </td>
			<td style="vertical-align: top;"> </td>
		</tr>
	</tbody>
</table>

<h3><a id="StoreProductType+domain" class="HashLink" href="#StoreProductType+domain">StoreProductType domain</a></h3>

<p>Nature of the purchased product.</p>

<table border="0" cellpadding="1" cellspacing="1" style="border-collapse: collapse;">
	<tbody>
		<tr>
			<td style="vertical-align: top;"><strong>Subscription </strong></td>
			<td style="vertical-align: top;">The purchase is a subscription.</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"><strong>Product</strong></td>
			<td style="vertical-align: top;">The purchase is a product.</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"> </td>
			<td style="vertical-align: top;"> </td>
		</tr>
	</tbody>
</table>

<h3><a id="StorePurchaseStatus+domain" class="HashLink" href="#StorePurchaseStatus+domain">StorePurchaseStatus domain</a></h3>

<p>Status of a purchase after it has been validated with the platform stores (Google/Apple).</p>

<table border="0" cellpadding="1" cellspacing="1" style="border-collapse: collapse;">
	<tbody>
		<tr>
			<td style="vertical-align: top;"><strong>Invalid</strong></td>
			<td style="vertical-align: top;">The purchase is invalid.</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"><strong>Valid</strong></td>
			<td style="vertical-align: top;">The purchase is valid.</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"><strong>Expired</strong></td>
			<td style="vertical-align: top;">Indicate if the purchase of a subscription has been expired.</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"><strong>Canceled </strong></td>
			<td style="vertical-align: top;">On iOS indicate if the purchase has been canceled by the Apple Store Support Team.<br />
			On Android, if the purchase has been canceled by the user, or if the purchase is a subscription canceled by the system (e.g. billing problem)  </td>
		</tr>
		<tr>
			<td style="vertical-align: top;"><strong>Deferred</strong></td>
			<td style="vertical-align: top;">The purchase is waiting for validation of parental control.</td>
		</tr>
		<tr>
			<td style="vertical-align: top;"> </td>
			<td style="vertical-align: top;"> </td>
		</tr>
	</tbody>
</table>

<h2><a id="Structured+Data+Types" class="HashLink" href="#Structured+Data+Types">Structured Data Types</a></h2>

<h3><a id="PurchaseResult" class="HashLink" href="#PurchaseResult">PurchaseResult</a></h3>

<ul>
	<li>Success:<a href="4374.html">Boolean</a><br />
	Indicates if the purchase process was successfully completed.<br />
	 </li>
	<li>PurchaseId:<a href="6778.html">VarChar(100)</a><br />
	Purchase identifier from the platform store.<br />
	 </li>
	<li>PurchasePlatform:StorePurchasePlatform <br />
	Store platform where the purchase was made.<br />
	 </li>
	<li>ProductIdentifier:<a href="6778.html">VarChar(100)</a><br />
	Purchased product identifier.<br />
	 </li>
	<li>TransactionData:<a href="6778.html">VarChar(100)</a><br />
	Encrypted data of the purchase transaction.<br />
	 </li>
</ul>

<h3><a id="PurchaseInformation" class="HashLink" href="#PurchaseInformation">PurchaseInformation</a></h3>

<p>Given a platform store, it keeps the information of a collection of purchases.</p>

<ul>
	<li>Purchases:Collection( PurchaseResult )<br />
	Collection of purchase result for each product queried.<br />
	 </li>
	<li>Receipt:<a href="7371.html">LongVarChar(2M)</a><br />
	Receipt information retrived from Apple.<br />
	 </li>
	<li>PurchasePlatform:StorePurchasePlatform<br />
	The store platform where the purchase was made.<br />
	 </li>
</ul>

<h3><a id="StoreProduct" class="HashLink" href="#StoreProduct">StoreProduct</a></h3>

<ul>
	<li>LocalizedTitle:<a href="6778.html">VarChar(100)</a><br />
	Product title in the user local language.<br />
	 </li>
	<li>LocalizedDescription:<a href="6778.html">VarChar(100)</a><br />
	Product description in the user local language.<br />
	 </li>
	<li>LocalizedPriceAsString:<a href="6778.html">VarChar(100)</a><br />
	String with the product price indicated in the user local currency.<br />
	 </li>
	<li>Identifier:<a href="6778.html">VarChar(100)</a><br />
	Product identifier.<br />
	 </li>
	<li>Purchased:<a href="4374.html">Boolean</a><br />
	Indicates if the product has been purchased by the user.<br />
	 </li>
</ul>

<h2><a id="Notes" class="HashLink" href="#Notes">Notes</a></h2>

<ul>
	<li>The concept of &quot;<em>enable a product</em>&quot; introduced in the <em>PurchaseStateChange event</em> section is only applicable for iOS that manages the purchases on the client-side. Android, on the other hand, centralizes the purchases on the Google Play's servers and it only notices when a product was purchased or not. For example, the &quot;<em>enable</em>&quot; concept allows the developer to implement a gift-mechanism on the device (i.e. under certain conditions, it is possible to enable a product for free). The same scenario on Android can be solved from the <a href='https://play.google.com/apps/publish/'>Google Play's console</a> using <a href='https://developer.android.com/google/play/billing/billing_promotions.html'>In-app Promotion codes</a>.</li>
	<li>In order to simulate the &quot;deferred&quot; state in iOS, the developer can add the <em>GXSimulateAskToByInSandbox</em> key into the generated project adopting boolean value.<br />
	A typical scenario is when the app is installed in a children's device and the developer uses <em>Progress.Show()</em> while the purchase is being validated. If the parent takes a long time to validate or reject the request of its child, the progress status will be displayed indefinitely. </li>
</ul>

<h2><a id="Scope" class="HashLink" href="#Scope">Scope</a></h2>

<table border="0" cellpadding="1" cellspacing="1">
	<tbody>
		<tr>
			<td><b>Platforms </b></td>
			<td>Smart Devices (iOS, Android)</td>
		</tr>
	</tbody>
</table>

<h2><a id="Availability" class="HashLink" href="#Availability">Availability</a></h2>

<p>This external object is available as from <a href="https://wiki.genexus.com/commwiki/wiki?33278,," target="_blank">GeneXus 15 Upgrade 3</a>.</p>

<p>See also</p>

<ul>
	<li><a href="https://wiki.genexus.com/commwiki/wiki?20003,," target="_blank">What is an In-App Purchase</a></li>
	<li><a href="21330.html">How to configure In-App Billing in an Android application</a></li>
	<li><a href="20010.html">In-App Purchase Sample - Classified Ads</a></li>
	<li><a href="20021.html">In-App Purchase Sample - My Kitchen</a></li>
</ul>

<p><span style="line-height: 1.6em;"></span></p>

<p><br />
</p>
<br /><br /></td></tr></tbody></table><hr /><table id="Pages" class="Table" cellpadding="1" cellspacing="2" style=" width: 100%;" ><TR><TD><b>Backlinks</b></TD></TR><TR><TD><a href="31268.html">GeneXus Core module</a></TD></TR><TR><TD><a href="21330.html">How to configure In-App Billing in an Android application</a></TD><TD><a href="20010.html">In-App Purchase Sample - Classified Ads</a></TD><TD><a href="24799.html">Toc:Native Mobile Applications Development</a></TD><TD><a href="15288.html">Category:Smart Devices API</a></TD></TR><TR><TD><a href="47543.html">Use Huawei In App Billing property</a></TD></TR></table>
</span></body>
</html><hr /><table id="Pages" class="Table" cellpadding="1" cellspacing="2" style=" width: 100%;" ><TR><td align="left"><font face="Verdana" size="1"><em>Source: <a href="https://wiki.genexus.com" target=_blank>wiki.genexus.com</a></em></font></td><td align="right"><font face="Verdana" size="1"><em>Last modification: 07/31/20 01:21 PM</em></font></td></TR></table></font>
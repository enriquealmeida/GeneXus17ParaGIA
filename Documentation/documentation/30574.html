<!DOCTYPE html>
<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="./images/WikiTheme2.css"/>
<link rel="stylesheet" type="text/css" href="./images/bootstrap.min.css"/>
<title>File Upload control</title>
</head>
<body bgcolor="#FFFFFF" style="display: block;margin: 8px;"><span id="W0004BODY" class="WikiBody"><table border=0 width=100%><tr><td><div align="right"><FONT face=Verdana size=2><a href =https://wiki.genexus.com/commwiki/wiki?30574,, target=_"blank">Newest Version</a></FONT></div></td></tr></table><h1 class="WikiName">File Upload control</h1>
<!--File Upload control--><table class="TableWikiBody" id="tblwikibody"><tbody><tr><td><p>File Upload is an HTML5 control whose purpose is to enable the end-users to upload multiple files to the web server's file system at the same time. Those files can be handled as needed afterward.</p>

<p>The control is distributed with GeneXus and has the following characteristics:</p>

<ul>
	<li>The files to upload can be dragged to the form.</li>
	<li>Each file can be uploaded independently from the rest, or all can be uploaded at once. The upload progress can be seen for all the files being uploaded.</li>
	<li>It shows a preview of the image, audio or video file being uploaded (if the browser supports that format).</li>
	<li>It's a control for <a href="25159.html">Responsive Web Applications</a>.</li>
	<li>Runs in Chrome, Firefox, Safari, and IE&gt;=8</li>
</ul>

<p>The control can be found in the Extended Controls section of the Toolbox and should be dragged to the form. Only the <a href="25209.html">Abstract layout</a> supports this control.</p>

<p><img src="./images/30575.png" id="30575" class="WikiImage"/></p>

<p>When the control is dragged to the form, the FileUploadData SDT is imported to the KB. Its purpose is to get <span style="background-color: rgb(245,246,245);">the </span>file data that is going to be uploaded.</p>

<p><img src="./images/32493.png" id="32493" class="WikiImage"/></p>

<h2><a id="How+to+use+the+control" class="HashLink" href="#How+to+use+the+control">How to use the control</a></h2>

<ol>
	<li>At design time, you need to configure the Uploaded Files control property. It should be assigned to a variable based on the FileUploadData SDT collection data type.</li>
</ol>

<p><img src="./images/30576.png" id="30576" class="WikiImage"/></p>

<p>       2. When the files are uploaded, you can get them using the variable associated with the Upload Files property. The files are uploaded to the server file system, to the location indicated on the <a href="7628.html">Temp media directory property</a>. Those files are deleted from the server on a basis established <a href='http://www2.gxtechnical.com/portal/hgxpp001.aspx?15,4,61,O,S,0,,35728'>here</a>. In Java, the files are deleted according to <a href='http://www2.gxtechnical.com/portal/hgxppredirect.aspx?15,26,0,,,19204'>this</a> document. Then, using the <a href="6915.html">File data type</a> is recommended to check for the existence of the file before using it.</p>

<h2><a id="Control+Properties" class="HashLink" href="#Control+Properties">Control Properties</a></h2>

<table border="1" cellpadding="1" cellspacing="1" style="width: 500.0px;">
	<tbody>
		<tr>
			<td><strong>Auto Upload</strong></td>
			<td>By default, files added to the widget are uploaded when the user clicks on the start buttons. To enable automatic uploads, set this property to true</td>
		</tr>
		<tr>
			<td><strong>Tooltip Text</strong></td>
			<td>Sets the tooltip text to show on the &quot;Add files&quot; button</td>
		</tr>
		<tr>
			<td><strong>Enable Uploaded File Canceling</strong></td>
			<td>By default, already uploaded files cannot be canceled, only file that haven't been uploaded can be canceled. To enable canceling already uploaded files, set this property to true. Canceled uploaded files will be removed from the SDT collection bound to the UploadedFiles property.</td>
		</tr>
		<tr>
			<td><strong>Disable Image Resize</strong></td>
			<td>Set to true to disable the automatic resize of images done by the control. If false, the image will be automatically resized depending on its size.</td>
		</tr>
		<tr>
			<td><strong>Max File Size</strong></td>
			<td>The maximum allowed file size in bytes. This option only has an effect for browsers supporting the <a href='http://caniuse.com/#feat=fileapi'>File API</a>.</td>
		</tr>
		<tr>
			<td><strong>Max Number Of Files</strong></td>
			<td>Set this property to limit the number of files that are allowed to be uploaded using this control. Specify 0 for unlimited file uploads.</td>
		</tr>
		<tr>
			<td><strong>Auto Disable Adding Files</strong></td>
			<td>Set to true to automatically disable the Add files button and disabling file dropping on the control when MaxNumberOfFiles property is set and the files limit is reached.</td>
		</tr>
		<tr>
			<td><strong>Accepted File Types</strong></td>
			<td>
			<p>Indicates the types of files the control will accept. To specify a custom type list, set this property to Custom value and use the Custom File Types property to specify the accepted file types.</p>

			<p> </p>

			<p>Possible values:</p>

			<ul>
				<li>All types (*.*)</li>
				<li>Image (*.png, *.gif, *.jpg, *.jpeg)</li>
				<li>Audio (*.mp3, *.wav, *.ogg, *.3gp, *,aac, *.wma)</li>
				<li>Video (*.avi, *flv, *wmv, *.mov, *.mp4)</li>
				<li>Custom</li>
			</ul>
			</td>
		</tr>
		<tr>
			<td><strong>Custom File Types</strong></td>
			<td>A comma-separated list of accepted file extensions. For example: doc, xls ,pdf.</td>
		</tr>
		<tr>
			<td><strong>Uploaded Files</strong></td>
			<td>A FileUploadData SDT collection, containing the uploaded files.</td>
		</tr>
		<tr>
			<td><strong>Failed Files</strong></td>
			<td>A FileUploadData SDT collection, containing the failed uploads.</td>
		</tr>
	</tbody>
</table>

<h2><a id="Control+Events" class="HashLink" href="#Control+Events">Control Events</a></h2>

<table border="1" cellpadding="1" cellspacing="1" style="width: 500.0px;">
	<tbody>
		<tr>
			<td><strong>UploadComplete</strong></td>
			<td>The event is automatically executed when one or more files have finished being uploaded.</td>
		</tr>
		<tr>
			<td><strong>UploadFailed</strong></td>
			<td>This event allows consulting the failed uploads.</td>
		</tr>
	</tbody>
</table>

<h2><a id="Control+Methods" class="HashLink" href="#Control+Methods">Control Methods</a></h2>

<table border="1" cellpadding="1" cellspacing="1" style="width: 500.0px;">
	<tbody>
		<tr>
			<td><strong>StartUpload  </strong></td>
			<td>The upload action is triggered. Can be used in any event, but uploaded files information will only be available in the UploadComplete event.</td>
		</tr>
	</tbody>
</table>

<h2><a id="How+to+configure+the+appearance+of+the+File+Upload+UC" class="HashLink" href="#How+to+configure+the+appearance+of+the+File+Upload+UC">How to configure the appearance of the File Upload UC</a></h2>

<p>Use the FileUpload Class of the Theme (or define one of its descendants).</p>

<p>The FileUpload class is assigned by default to the <a href="8741.html">Class property</a> of the UC.</p>

<p><img src="./images/30582.png" id="30582" class="WikiImage"/></p>

<p>The Class can be edited on the Theme, as follows:</p>

<p><img src="./images/30583.png" id="30583" class="WikiImage"/></p>

<ul>
	<li><em>Add File Button Class</em>: Class used to style the &quot;Add Files&quot; button.</li>
	<li><em>Start Button Class</em>: Class used to style the &quot;Start&quot; buttons.</li>
	<li><em>Cancel Button Class</em>: Class used to style the &quot;Cancel&quot; buttons.</li>
	<li><em>Buttons Bar Class</em>: Class used to style the bar containing the buttons on top of the files table.</li>
	<li><em>Drop Zone Class</em>: Class used to style the area where files are dropped.</li>
	<li><em>Files Table Class</em>: Class used to style the table where files are displayed.</li>
	<li><em>File Preview Class</em>: Class used to style the file preview.</li>
	<li><em>File Name Class</em>: Class used to style the file name text.</li>
	<li><em>File Size Class</em>: Class used to style the file size text.</li>
	<li><em>Error Message Class</em>: Class used to style the error messages of the control.</li>
</ul>

<h2><a id="How+to+change+the+captions+of+the+buttons" class="HashLink" href="#How+to+change+the+captions+of+the+buttons">How to change the captions of the buttons</a></h2>

<p>The captions of the buttons are GeneXus standard messages. If you want to change them, you have to access the language object and unmark the &quot;Show only user messages&quot; filter. The captions of the buttons of the FileUpload User Control have the GXM_fileupload prefix.</p>

<p><img src="./images/39483.png" id="39483" class="WikiImage"/></p>

<h2><a id="Example" class="HashLink" href="#Example">Example</a></h2>

<p>Consider the following two <a href="1908.html">Transactions</a> (both are set as <a href="5846.html">Business Component</a>):</p>

<p><img src="./images/30577.png" id="30577" class="WikiImage"/></p>

<p>Look at the ProductPanel object:  </p>

<p><img src="./images/30615.png" id="30615" class="WikiImage"/></p>

<p>It receives the &amp;ProductId as a parameter. It loads the Product information and allows the end-user to make any changes to the product basic information (name or price). Also, it offers a button to upload several photos related to this product. When that button is clicked, another <a href="6916.html">Web Panel</a> is called. There the end-user can choose multiple files to upload at the same time. Besides, he/she can also remove photos.</p>

<p>Then, the resulting form looks as follows:</p>

<p><img src="./images/30616.png" id="30616" class="WikiImage"/></p>

<p>Note that the File Upload control has been dragged to the form and the &quot;Uploaded Files&quot; property has been assigned to the &amp;FileUploadedDataColl variable. Also, note that the photos that have already been uploaded are going to be displayed using a grid.</p>

<p>Below you can see the part of the code related to the saving process of the photos in the database. To see the entire example, download it from <a href="https://wiki.genexus.com/commwiki/wiki?30581,," target="_blank">FileUpload UC sample</a>.</p>

<pre class="prettyprint lang-genexus" style="max-width: 100%">
Event 'Confirm'

    for &amp;FileUploadData in &amp;FileUploadDataColl

        &amp;ProductPhotoItem = new()
        &amp;ProductPhotoItem.ProductId = &amp;ProductId
        &amp;ProductPhotoItem.ProductPhoto = &amp;FileUploadData.File
        &amp;ProductPhotoItem.Save()
        if &amp;ProductPhotoItem.Success()
            commit
            &amp;count += 1
            msg(format(!&quot;Data sucessfully added: File #%1&quot;,&amp;count.Tostring()))
        else
            &amp;ErrorMessage = &amp;ProductPhotoItem.GetMessages().Item(1).Description
            msg(format(!&quot;There was an error uploading the images: %1&quot;,&amp;ErrorMessage))
        endif

    endfor
    grid1.Refresh()
Endevent</pre>

<p>Basically, the &amp;FileUploadDataColl collection is scanned and each photo is saved to the database.</p>

<p>The ProductPhotoId is assigned by the following rule which is defined in the ProductPhoto Transaction:</p>

<pre class="prettyprint lang-genexus" style="max-width: 100%">
serial(productPhotoId,ProductPhotoLastId,1);</pre>

<p>At runtime, the form looks as follows:</p>

<p><img src="./images/30617.png" id="30617" class="WikiImage"/></p>

<p><img src="./images/30618.png" id="30618" class="WikiImage"/></p>

<h3><a id="Tip%3A+check+maximum+requests+size+%28.NET%29" class="HashLink" href="#Tip%3A+check+maximum+requests+size+%28.NET%29">Tip: check maximum requests size (.NET)</a></h3>

<p>By default, requests size is limited to 4M, so if a file bigger than 4M is being uploaded an error like &quot;Error Internal Server Error&quot; occurs.</p>

<p>Using browser developers tools (F12) the error shows: &quot;Failed to load resource: the server responded with a status of 500 (Internal Server Error) Gxobject.aspx:1&quot;</p>

<p>Using Windows event viewer it shows: &quot;Exception message: Maximum request length exceeded.&quot;</p>

<p><strong>How to fix it?</strong></p>

<p>Try to set a higher &quot;maximum request size&quot; value in web.config file.<br />
Example to limit to 20M:</p>

<pre class="prettyprint lang-genexus" style="max-width: 100%">
&lt;system.web&gt;
    &lt;httpRuntime executionTimeout=&quot;600&quot; maxRequestLength=&quot;20120&quot;/&gt;</pre>

<p> </p>

<p>Download sample from <a href="https://wiki.genexus.com/commwiki/wiki?30581,," target="_blank">FileUpload UC sample</a></p>

<p><br />
<br />
<br />
</p>
<br />
</td></tr></tbody></table><script src="./images/run_prettify.js?lang=genexus"></script><hr /><table id="Pages" class="Table" cellpadding="1" cellspacing="2" style=" width: 100%;" ><TR><TD><b>Backlinks</b></TD></TR><TR><TD><a href="42229.html">Accepted File Types property</a></TD><TD><a href="41585.html">Add File Button Class property</a></TD><TD><a href="41583.html">Auto Disable Adding Files property</a></TD></TR><TR><TD><a href="42089.html">AutoUpload property</a></TD><TD><a href="6704.html">Blob data type</a></TD><TD><a href="41588.html">Buttons Bar Class property</a></TD><TD><a href="41587.html">Cancel Button Class property</a></TD></TR><TR><TD><a href="5928.html">Category:Common Controls</a></TD><TD><a href="41584.html">Custom File Types property</a></TD><TD><a href="46555.html">Disable Image Resize property</a></TD><TD><a href="41589.html">Drop Zone Class property</a></TD></TR><TR><TD><a href="41590.html">Drop Zone Text Class property</a></TD><TD><a href="41581.html">Enable Uploaded File Canceling property</a></TD><TD><a href="41597.html">Error Message Class property</a></TD><TD><a href="47268.html">Failed Files property</a></TD></TR><TR><TD><a href="41595.html">File Name Class property</a></TD><TD><a href="41594.html">File Preview Class property</a></TD><TD><a href="41596.html">File Size Class property</a></TD><TD><a href="41593.html">Files Table Cell Class property</a></TD></TR><TR><TD><a href="41591.html">Files Table Class property</a></TD><TD><a href="41592.html">Files Table Row Class property</a></TD><TD><a href="47224.html">FileUpload command examples</a></TD></TR><TR><TD><a href="47293.html">Hide Additional Buttons property</a></TD><TD><a href="42090.html">Max File Size property</a></TD><TD><a href="41582.html">Max Number Of Files property</a></TD></TR><TR><TD><a href="41601.html">Show Buttons Icons property</a></TD><TD><a href="41600.html">Show File Buttons property</a></TD><TD><a href="41599.html">Show File Preview property</a></TD><TD><a href="41598.html">Show File Size property</a></TD></TR><TR><TD><a href="41586.html">Start Button Class property</a></TD><TD><a href="42516.html">Tooltip Text property</a></TD><TD><a href="42230.html">Uploaded Files property</a></TD></TR></table>
</span></body>
</html><hr /><table id="Pages" class="Table" cellpadding="1" cellspacing="2" style=" width: 100%;" ><TR><td align="left"><font face="Verdana" size="1"><em>Source: <a href="https://wiki.genexus.com" target=_blank>wiki.genexus.com</a></em></font></td><td align="right"><font face="Verdana" size="1"><em>Last modification: 06/17/21 02:17 PM</em></font></td></TR></table></font>
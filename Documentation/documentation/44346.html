<!DOCTYPE html>
<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="./images/WikiTheme2.css"/>
<link rel="stylesheet" type="text/css" href="./images/bootstrap.min.css"/>
<title>Howto: Chatbots using WhatsApp</title>
</head>
<body bgcolor="#FFFFFF" style="display: block;margin: 8px;"><span id="W0004BODY" class="WikiBody"><table border=0 width=100%><tr><td><div align="right"><FONT face=Verdana size=2><a href =https://wiki.genexus.com/commwiki/wiki?44346,, target=_"blank">Newest Version</a></FONT></div></td></tr></table><h1 class="WikiName">Howto: Chatbots using WhatsApp</h1>
<!--Howto: Chatbots using WhatsApp--><table class="TableWikiBody" id="tblwikibody"><tbody><tr><td><p>This document explains the steps needed to integrate your chatbot with WhatsApp. You can use any Whatsapp partner but in this article <a href='http://twilio.com'>Twilio</a> will be the example used.</p>

<p>The architecture is as follows: The Whatsapp partner (e.g: Twilio) receives the user messages and there is a webhook to process those messages (the webhook must be configured on the Whatsapp partner). It should interact with some procedures of the <em>GeneXusChannels</em> module so the messages are formatted, and sent to the chatbot.<br />
At the end of the process, the response message is sent to the partner to be sent to the user's WhatsApp. <br />
In the webhook procedure, the Authorization Token given by the partner, should be set.</p>

<p>Below is the architecture schema and details on the solution.</p>

<p><img src="./images/44351.png" id="44351" class="WikiImage"/></p>

<h2><a id="1.+Configure+the+partner%27s+account" class="HashLink" href="#1.+Configure+the+partner%27s+account">1. Configure the partner's account</a></h2>

<p>This step depends on the Whatsapp partner you use.</p>

<p>As an example, see <a href="44121.html">Chatbots using Whatsapp: How to set up Twilio</a>.</p>

<h2><a id="2.+Creating+the+Webhook" class="HashLink" href="#2.+Creating+the+Webhook">2. Creating the Webhook</a></h2>

<p>The Webhook is automatically generated by configuring in the KB the following properties:</p>

<ul>
	<li><a href="https://wiki.genexus.com/commwiki/wiki?45163,," target="_blank">Enable WhatsApp property</a></li>
	<li><a href="45164.html">WhatsApp Partner property</a></li>
	<li>The partner Token. (e.g: <a href="https://wiki.genexus.com/commwiki/wiki?45166,," target="_blank">Twilio Token property</a>)</li>
</ul>

<p>It's generated under the instance's module, and its name is <b>WhatsappWebhook</b>.</p>

<p><div style="background-color: rgb(255,255,204);border-left: 6.0px solid rgb(255,255,0);margin-bottom: 15.0px;padding: 4.0px 12.0px;"><strong>Warning</strong>:  The URL to the web hook should include the module. I.e, in .NET: http://server/baseURL/moduleName.WhatsappWebhook.aspx.</div>
</p>

<p>The Auth Token of the partner is stored in the configuration file (GXCF_Chatbots.config).</p>

<h3><a id="Message+data+type" class="HashLink" href="#Message+data+type">Message data type</a></h3>

<p>The following are some of the data types used, which are part of the GeneXusChannels Module.</p>

<p>The Message SDT belongs to the <em>GeneXusChannels</em> Module and allows you to specify the messages to send. Define messages of a specific type, such as grids, videos, images, etc. <br />
It supports sending a text message and a payload for multimedia.</p>

<p><img src="./images/44348.png" id="44348" class="WikiImage"/></p>

<h3><a id="ChannelConfiguration+data+type" class="HashLink" href="#ChannelConfiguration+data+type">ChannelConfiguration data type</a></h3>

<p>This SDT is used for storing the information returned by the channel.<br />
It allows specifying the channel (Messenger, Whatsapp) and the configuration parameters (collection Key - Value pair).</p>

<p><img src="./images/44349.png" id="44349" class="WikiImage"/></p>

<h3><a id="Troubleshooting" class="HashLink" href="#Troubleshooting">Troubleshooting</a></h3>

<p>If the user receives no answer, please check:</p>

<ol>
	<li>The partner logs. For example, the Twilio logs look as follows:<br />
	<br />
	<img src="./images/44359.png" id="44359" class="WikiImage"/><br />
	 </li>
	<li>Generator trace. For instance, activate the ASP Net trace when using .NET.</li>
</ol>

<h3><a id="See+also" class="HashLink" href="#See+also">See also</a></h3>

<p>In order to add integrate to any Whatsapp partner that is not included in the list of partners given by the <a href="45164.html">WhatsApp Partner property</a>, you can do it following the <a href="46271.html">Howto: Integrate a new WhatsApp partner into a GeneXus Chatbot</a> document.</p>

<p><strong>Note: Chatbot without NLP (command oriented)</strong></p>

<p>If you want to have a chatbot that doesn't use NLP (Natural Language Processing), you don't need to call the <em>SendMessageFromChannel </em>procedure. You only need to use the <em>WhatsappTwilioWebhook </em>to load the ChannelConfiguration, then process the &amp;Message received, and use the <em>GeneXusChannels.Message.SendMessage</em> procedure to send the response to the final user.<br />
<br />
In this case you only need the GeneXusChannels module (you don't need to install the Chatbot module).</p>

<p>Since <a href="https://wiki.genexus.com/commwiki/wiki?45624,," target="_blank">GeneXus 16 upgrade 10</a> the Chatbot generator generates automatically the kind of chatbots that do not use NLP. See <a href="https://wiki.genexus.com/commwiki/wiki?45151,," target="_blank">Scripted Chatbots</a>.</p>

<h3><a id="Sample" class="HashLink" href="#Sample">Sample</a></h3>

<p>See <a href="44319.html">Chatbots sample using WhatsApp</a>.</p>

<p> </p>

<p></p>

<p></p>

<p></p>

<p> </p>
<br />
</td></tr></tbody></table><hr /><table id="Pages" class="Table" cellpadding="1" cellspacing="2" style=" width: 100%;" ><TR><TD><b>Backlinks</b></TD></TR><TR><TD><a href="38520.html">Toc:Chatbots in GeneXus</a></TD><TD><a href="44121.html">Chatbots using Whatsapp: How to set up Twilio</a></TD></TR><TR></TR><TR><TD><a href="45850.html">HowTo: Get the User ID when using chatbots and WhatsApp channel</a></TD><TD><a href="46271.html">Howto: Integrate a new WhatsApp partner into a GeneXus Chatbot</a></TD><TD><a href="45164.html">WhatsApp Partner property</a></TD></TR></table>
</span></body>
</html><hr /><table id="Pages" class="Table" cellpadding="1" cellspacing="2" style=" width: 100%;" ><TR><td align="left"><font face="Verdana" size="1"><em>Source: <a href="https://wiki.genexus.com" target=_blank>wiki.genexus.com</a></em></font></td><td align="right"><font face="Verdana" size="1"><em>Last modification: 05/28/21 07:25 PM</em></font></td></TR></table></font>
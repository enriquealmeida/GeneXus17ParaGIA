<!DOCTYPE html>
<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="./images/WikiTheme2.css"/>
<link rel="stylesheet" type="text/css" href="./images/bootstrap.min.css"/>
<title>Good practices for secure development using GAM</title>
</head>
<body bgcolor="#FFFFFF" style="display: block;margin: 8px;"><span id="W0004BODY" class="WikiBody"><table border=0 width=100%><tr><td><div align="right"><FONT face=Verdana size=2><a href =https://wiki.genexus.com/commwiki/wiki?47241,, target=_"blank">Newest Version</a></FONT></div></td></tr></table><h1 class="WikiName">Good practices for secure development using GAM</h1>
<!--Good practices for secure development using GAM--><div class="TableWikiBody" id="tblwikibody"><p>The following are recommendations to follow when you develop some aspects of your application in order to avoid some common issues and develop in the most secure way your applications. Is important to review the article <a href="47237.html">Hardening of GeneXus Systems and Deployments with GAM</a>.</p>

<h3><a id="Re-authentication" class="HashLink" href="#Re-authentication">Re-authentication</a></h3>

<p>Each reality, according to its business rules and logic, will have its own sensitive operations. By activating GAM, it is possible to implement re-authentication to make sure that the user running them is the one logged in and not someone else impersonating him or her.</p>

<p>Access to the operation should be controlled by offering users a prompt or redirection to another <a href="24829.html">Panel</a> so that they can re-enter their credentials. The logic of this Panel will use the Login() function of the external object GAMRepository with the additional parameter isBatch:</p>

<pre class="prettyprint lang-genexus" style="max-width: 100%">
&amp;GAMLoginAdditionalParameters.isBatch = True
// Login User
&amp;LoginOK = GAMRepository.Login(&amp;UserName, &amp;UserPassword, &amp;GAMLoginAdditionalParameters, &amp;Errors)
If not &amp;LoginOK
    // Process Error
EndIf</pre>

<p>In the event of an error, do not continue with the redirection to the protected operation; if the validation is made within a <a href="6293.html">Procedure</a> where the operation is executed, return immediately.</p>

<p>For more details, read: <a href="19269.html">GAM Login Method</a></p>

<h3><a id="Subscription+to+GAM+events" class="HashLink" href="#Subscription+to+GAM+events">Subscription to GAM events</a></h3>

<p>The purpose of subscribing to “GAM Events” is to allow the execution of additional external code after a GAM event has occurred; i.e. customized event handling after GAM's own internal handling. Examples of events are addition/deletion/modification of users and roles.</p>

<p>This is particularly important for alerting users about potentially unauthorized changes to their profile. For this, the developer must implement a Procedure that complies with the input and output parameters specified by GAM and according to its logic, alerts users about the updating of their data by the means available, usually by email.</p>

<p>The parameter rule of the Procedure should look as follows:</p>

<pre class="prettyprint lang-genexus" style="max-width: 100%">
Parm(in:&amp;EventName, in:&amp;jsonIN, out:&amp;jsonOUT);

</pre>

<p>Then, in the Procedure code, a variable of GAMUser type can be loaded from the &amp;jsonIN parameter because the corresponding event to subscribe to is User_Update. From there, you can obtain the user's email address to send the alert. If it is a false alarm, the user can ignore it.</p>

<p>To record the subscription to a GeneXus program event, you can use the web back office or the <a href="16535.html">GAM API</a>.</p>

<p>For more details, read: <a href="32698.html">GAM Events subscription</a></p>

<h3><a id="Access+to+files" class="HashLink" href="#Access+to+files">Access to files</a></h3>

<p>Any file that is not generated by the application independently of user-controlled data and is not there since deployment should be considered as unreliable. The upload functionalities of user-provided files such as images, Excel spreadsheets, and PDF documents, among others, can be manipulated to upload other unexpected file types. On one hand, this requires strict validations in the GeneXus code considering allowed extensions. On the other hand, all files must be located outside the root directory of the application.</p>

<p>By default, uploaded files are temporarily stored in the PrivateTempStorage directory, which is not accessible. Later on, their location depends entirely on the loading logic. As for multimedia files, they are often moved to the PublicTempStorage directory, where they are publicly accessible. If they are stored through programming in other locations, it is extremely important that the destination directory is separate and restricted.</p>

<p>Ideally, access to static content should be achieved through programming by considering the following:</p>

<ul>
	<li>The server file system is not accessible via HTTP.</li>
	<li>The access URL does not contain a visible path. Instead, use a complex identifier such as a UUID (Universal Unique Identifier) associated with the file, which allows obtaining the actual path through programming for processing.</li>
	<li>With programmatic control, it is possible to find out if the user is anonymous or registered in the system, to obtain his permissions and confirm that he is authorized to access.</li>
	<li>Use GeneXus’ HTTPResponse object to return the static file, having the file location loaded into a variable:</li>
</ul>

<pre class="Code" style="margin-left: 80.0px;">
&amp;HttpResponse.AddFile(&amp;FileName)
</pre>

<ul>
	<li>Specify the type of content by adding the Content-Type header with its corresponding MIME Type value. For example, if it is a PDF document:</li>
</ul>

<pre class="Code" style="margin-left: 80.0px;">
&amp;HttpResponse.AddHeader(“Content-Type”, “application/pdf”)
</pre>

<ul>
	<li>In the case that the file has to be downloaded, you have to include the following header indicating the filename (it doesn’t have to match the name on the source server):</li>
</ul>

<pre class="Code" style="margin-left: 80.0px;">
&amp;HttpResponse.AddHeader(“Content-Disposition”, “attachment;filename=” + &amp;FileName)</pre>

<ul>
	<li>Likewise, it is possible to add headers such as X-Frame-Options or X-Content-Type-Options if they are not automatically added by the server (see “Configuring HTTP headers”).</li>
</ul>

<p>For more details, read:</p>

<ul>
	<li><a href="6934.html">HttpResponse data type</a></li>
	<li><a href="7628.html">Temp media directory property</a></li>
	<li><a href="6979.html">Blob local storage directory property</a></li>
</ul>

<h3><a id="Integrated+security+levels" class="HashLink" href="#Integrated+security+levels">Integrated security levels</a></h3>

<p>When you activate GAM in the <a href="1836.html">Knowledge Base</a>, the default integrated security level is Authentication. This covers access control for all objects so that they cannot be accessed without prior authentication. However, with this level of integrated security, it is not possible to control access on a per role basis; i.e. access is not restricted to users with different roles.</p>

<p>For permission-based access control after authentication, the security level integrated into the object must be changed to Authorization. As a result, access to all roles is denied by default (except for the administrator role) and permissions must be explicitly set for each role, which in turn is assigned to the corresponding users.</p>

<p>The proposal to improve application security consists of configuring the integrated security level to Authorization at the Knowledge Base level. This causes all objects to have this level, as long as the property has not been modified in any particular object (in which case the modified value is maintained). The improvement here is that the solution is less likely to leave objects unprotected or uncontrolled access based on user permissions, with the cost of setting a permission policy for application roles for each object. To keep the cost down, it is important to take this measure as early in the development as possible. Another benefit is that at the end of this task you will have full knowledge of which objects only require user authentication or must be publicly accessible.</p>

<p>For more details, read: <a href="15214.html">Integrated Security Level property</a></p>

<p></p>
</div><script src="./images/run_prettify.js?lang=genexus"></script><hr /><table id="Pages" class="Table" cellpadding="1" cellspacing="2" style=" width: 100%;" ><TR><TD><b>Backlinks</b></TD></TR><TR><TD><a href="24746.html">Toc:GeneXus Access Manager (GAM)</a></TD></TR></table>
</span></body>
</html><hr /><table id="Pages" class="Table" cellpadding="1" cellspacing="2" style=" width: 100%;" ><TR><td align="left"><font face="Verdana" size="1"><em>Source: <a href="https://wiki.genexus.com" target=_blank>wiki.genexus.com</a></em></font></td><td align="right"><font face="Verdana" size="1"><em>Last modification: 06/03/22 02:31 PM</em></font></td></TR></table></font>
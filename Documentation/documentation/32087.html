<!DOCTYPE html>
<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="./images/WikiTheme2.css"/>
<link rel="stylesheet" type="text/css" href="./images/bootstrap.min.css"/>
<title>Storage Provider API</title>
</head>
<body bgcolor="#FFFFFF" style="display: block;margin: 8px;"><span id="W0004BODY" class="WikiBody"><table border=0 width=100%><tr><td><div align="right"><FONT face=Verdana size=2><a href =https://wiki.genexus.com/commwiki/wiki?32087,, target=_"blank">Newest Version</a></FONT></div></td></tr></table><h1 class="WikiName">Storage Provider API</h1>
<!--Storage Provider API--><table class="TableWikiBody" id="tblwikibody"><tbody><tr><td><p>The Storage Provider API enables you to manage the application's global data (any type of files) in an external storage. The external storage can be Amazon, Azure, Google, or IBM Cloud.</p>

<p>The external storage used is the same as the one configured in <a href="31121.html">Storage Provider property</a>.</p>

<table border="1" cellpadding="1" cellspacing="1" style="width: 900.0px;">
	<tbody>
		<tr>
			<td>
			<h3><a id="Method" class="HashLink" href="#Method">Method</a></h3>
			</td>
			<td>
			<h3><a id="Description" class="HashLink" href="#Description">Description</a></h3>
			</td>
		</tr>
		<tr>
			<td style="width: 600.0px;"><strong>Upload</strong>(Character <em>&amp;FileFullPath</em>, [Character <em>&amp;FileFullName</em>], [out File <em>&amp;UploadedFile</em>], [out Messages &amp;Messages]):Boolean</td>
			<td style="width: 500.0px;">
			<p>Saves the file to the external storage and returns a reference (<a href="6915.html">File data type</a>) to it. Returns TRUE if the operation was successful and the external file can be returned.</p>

			<p><strong>&amp;FileFullPath</strong>:  to be saved to the external storage. It has to be a full path.</p>

			<p><strong>&amp;FileFullName</strong>: is the full name that the file will have in the bucket (including folders and extension). Optional parameter.</p>

			<p><strong>&amp;UploadedFile</strong>: is the file saved to the bucket. Use GetURI() to get the URI of the file in the storage.</p>

			<p><strong>&amp;Messages</strong>: a collection of Error and Warn Message returned. Optional parameter.</p>
			</td>
		</tr>
		<tr>
			<td><strong>UploadPrivate</strong>(Character &amp;FileFullPath, Character &amp;FileFullName, out File &amp;UploadedFile, [out Messages &amp;Messages ]):Boolean</td>
			<td>
			<p>Saves the file to the external storage and returns a reference (<a href="6915.html">File data type</a>) to it. Returns TRUE if the operation was successful and the external file can be returned.</p>

			<p>The uploaded file is private. So, in this case, the file is signed and uploaded to the bucket. The certificate used to sign the file is generated by the provider.</p>

			<p><strong>&amp;FileFullPath</strong>:  to be saved to the external storage. It has to be a full path.</p>

			<p><strong>&amp;FileFullName</strong>: is the full name that the file will have in the bucket (including folders and extension). Optional parameter.</p>

			<p><strong>&amp;UploadedFile</strong>: is the file saved to the bucket.</p>

			<p><strong>&amp;Messages</strong>: a collection of Error and Warn Message returned. Optional parameter.</p>
			</td>
		</tr>
		<tr>
			<td><strong>Get</strong>(Character <em>&amp;FileFullName</em>, out File <em>&amp;ExternalFile</em>, [out Messages <em>&amp;Messages</em> ]):Boolean</td>
			<td>
			<p>Returns a reference (<a href="6915.html">File data type</a>) of the file in the external storage. Returns TRUE if the operation was successful and the external file can be returned.</p>

			<p><strong>&amp;FileFullName</strong>: is the full name that the file has in the bucket (including folders and extension).</p>

			<p><strong>&amp;ExternalFile</strong>: is the file retrieved from the bucket. </p>

			<p><strong>&amp;Messages</strong>: a collection of Error and Warn Message returned.</p>
			</td>
		</tr>
		<tr>
			<td><strong>GetPrivate</strong>(Character &amp;FileFullName, out File &amp;ExternalFile, Numeric &amp;ExpirationMinutes, [out Messages &amp;Messages ]):Boolean</td>
			<td>
			<p>Returns a reference (<a href="6915.html">File data type</a>) of the file in the external storage. Returns TRUE if the operation was successful and the external file can be returned.</p>

			<p>The URL obtained is valid only for a period of time, determined by the <br />
			&amp;ExpirationMinutes parameter.</p>

			<p><strong>&amp;FileFullName</strong>: is the full name that the file has in the bucket (including folders and extension).</p>

			<p><strong>&amp;ExternalFile</strong>: is the file retrieved from the bucket. </p>

			<p><strong>&amp;ExpirationMinutes</strong>: Space of time during which the &amp;ExternalFile points to a valid URL.  </p>

			<p><strong>&amp;Messages</strong>: a collection of Error and Warn Message returned.</p>

			<p>Note: The URL returned by  &amp;ExternalFile.GetURI() is one that expires after expirationMinutes.</p>
			</td>
		</tr>
		<tr>
			<td><strong>Download</strong>(Character <em>&amp;FileFullName</em>, File <em>&amp;LocalFil</em>e, [out Messages <em>&amp;Messages</em> ]):Boolean</td>
			<td>
			<p>Downloads the external file to the application server and saves it locally. Returns TRUE if the operation was successful.</p>

			<p><strong>&amp;FileFullName</strong>: is the full name that the file has in the bucket (including folders and extension).</p>

			<p><strong>&amp;LocaFile</strong>: File where the external file is going to be saved after being downloaded.</p>

			<p><strong>&amp;Messages</strong>: a collection of Error and Warn Message returned.</p>
			</td>
		</tr>
		<tr>
			<td><strong>DownloadPrivate</strong>(Character <em>&amp;FileFullName</em>, File <em>&amp;LocalFil</em>e, [out Messages <em>&amp;Messages</em> ]):Boolean</td>
			<td>
			<p><strong>(Only applies to A</strong><strong>zure Storage Provider)</strong><br />
			Downloads the private external file to the application server and saves it locally. Returns TRUE if the operation was successful.</p>

			<p><strong>&amp;FileFullName</strong>: is the full name that the file has in the bucket (including folders and extension).</p>

			<p><strong>&amp;LocaFile</strong>: File where the external file is going to be saved after being downloaded.</p>

			<p><strong>&amp;Messages</strong>: a collection of Error and Warn Message returned.</p>
			</td>
		</tr>
		<tr>
			<td><strong>GetDirectory</strong>(Character <em>&amp;DirectoryFullName</em>, out Directory <em>&amp;ExternalDirectory</em>,[out Messages <em>&amp;Messages</em>]):Boolean</td>
			<td>
			<p>Returns a <a href="6567.html">Directory</a> in the external storage (the cloud). In Amazon, the format is &lt;bucketname&gt;: Directory</p>

			<p>Ex: genexuss3test:\petsFolder\</p>

			<p><strong>&amp;DirectoryFullName</strong>: Is the Directory name in the external storage.</p>
			</td>
		</tr>
	</tbody>
</table>

<p>Note: The &amp;Messages object is a collection of Messages.Message with the following format:</p>

<ul>
	<li>Id: The error code returned by the Storage Provider (Amazon S3, Google, etc)</li>
	<li>Type: (0 = Warning,1 = Error) </li>
	<li>Description: The error description returned by the Storage Provider.</li>
</ul>

<p>When there is no error, the &amp;Messages collection is empty.</p>

<h2><a id="Examples" class="HashLink" href="#Examples">Examples</a></h2>

<h3><a id="Uploading+an+image" class="HashLink" href="#Uploading+an+image">Uploading an image</a></h3>

<p>Consider a scenario where you need to upload files to the external storage manually. Note that the file to be uploaded to the external storage has been uploaded previously to the application server.</p>

<p>First, we define a <em>&amp;Storage</em> variable, of StorageProvider data type.</p>

<p><br />
The file to be saved to the external storage is originally located on the server's file system, so we use the <a href="6915.html">File data type</a> to get its absolute path.<br />
The <em>Upload</em> method of the Storage Provider API allows you to give a full name to the file being uploaded, including folders and extension.</p>

<pre class="prettyprint lang-genexus" style="max-width: 100%">
&amp;Storage = new() //This line of code creates a new instance of the external storage configured in the KB
&amp;File.Source =&quot;catToUpload.jpg&quot; //&amp;File is of File data type.
&amp;FileFullPath = &amp;File.GetAbsoluteName()
&amp;StorageObjectFullName = &quot;petsFolder/cat.jpg&quot;
if ( &amp;Storage.Upload(&amp;FileFullPath, &amp;StorageObjectFullName, &amp;UploadedFile, &amp;Messages) )
    &amp;URL = &amp;UploadedFile.GetURI() //&amp;URL of the uploaded file
else
     for &amp;Message in &amp;Messages
        msg(&amp;Message.Description, status)
    endfor
endif</pre>

<p> </p>

<p>In this example, given that the bucket name is genexuss3test, the folder petsFolder is created under that bucket and contains the file uploaded.</p>

<p><img src="./images/32498.png" id="32498" class="WikiImage"/></p>

<h3><a id="Getting+the+reference+to+a+file+in+the+external+storage" class="HashLink" href="#Getting+the+reference+to+a+file+in+the+external+storage">Getting the reference to a file in the external storage</a></h3>

<p>Here we get the URI of the file located in the external storage. &amp;ExternalFile is of <a href="6915.html">File data type</a>.</p>

<pre class="prettyprint lang-genexus" style="max-width: 100%">
&amp;StorageObjectFullName = &quot;petsFolder/cat.jpg&quot;
if ( &amp;Storage.Get(&amp;StorageObjectFullName, &amp;ExternalFile, &amp;Messages) )
    msg(format(&quot;The external URI of the image is : %1&quot;, &amp;ExternalFile.GetURI()), status)
else
    for &amp;Message in &amp;Messages 
      msg(&amp;Message.Description, status) 
    endfor
endif</pre>

<p>It returns: https://genexuss3test.s3.amazonaws.com/petsFolder/cat.jpg</p>

<h3><a id="Downloading+a+file+to+the+application+server%27s+file+system" class="HashLink" href="#Downloading+a+file+to+the+application+server%27s+file+system">Downloading a file to the application server's file system</a></h3>

<p>In this example, we download the external file to the server's file system. &amp;LocalFile is of File Data type.</p>

<pre class="prettyprint lang-genexus" style="max-width: 100%">
&amp;StorageObjectFullName = &quot;petsFolder/cat.jpg&quot;
&amp;LocalFile.Source = &quot;catDownloadFromStorage.jpg&quot;
if ( &amp;Storage.Download(&amp;StorageObjectFullName, &amp;LocalFile, &amp;Messages) )
    msg(format(&quot;Image downloaded to : %1&quot;, &amp;LocalFile.GetAbsoluteName()), status)
else
   for &amp;Message in &amp;Messages 
      msg(&amp;Message.Description, status) 
   endfor
endif
</pre>

<h3><a id="Deleting+the+files+in+the+external+storage+folder" class="HashLink" href="#Deleting+the+files+in+the+external+storage+folder">Deleting the files in the external storage folder</a></h3>

<p>Here we remove all the files from the external storage folder. &amp;ExternalDirectory is of <a href="6567.html">Directory data type</a>.</p>

<p>Note that the file is treated as an external file here.</p>

<pre class="prettyprint lang-genexus" style="max-width: 100%">
&amp;DirectoryFullName = &quot;petsFolder&quot;
if ( &amp;Storage.GetDirectory(&amp;DirectoryFullName, &amp;ExternalDirectory, &amp;Messages) )
    for &amp;ExternalFile in &amp;ExternalDirectory.GetFiles()
        &amp;ExternalFile.Delete()
    endfor
else
    msg(format(&quot;The directory %1 couldn't be obtained&quot;, &amp;DirectoryFullName))
    for &amp;Message in &amp;Messages   
        msg(&amp;Message.Description, status)   
    endfor
endif</pre>

<h3><a id="Example+using+Private+Files" class="HashLink" href="#Example+using+Private+Files">Example using Private Files</a></h3>

<pre class="prettyprint lang-genexus" style="max-width: 100%">
&amp;Storage = new() 
&amp;File.Source =&quot;catToUpload.jpg&quot; 
&amp;FileFullPath = &amp;File.GetAbsoluteName()
&amp;StorageObjectFullName = &quot;Private/cat1.jpg&quot;

if (&amp;Storage.UploadPrivate(&amp;FileFullPath, &amp;StorageObjectFullName) )
    msg(&quot;File has been successfuly uploaded&quot;, status)
else
     for &amp;Message in &amp;Messages
        msg(&amp;Message.Description, status)
    endfor
endif

&amp;Storage.GetPrivate(&amp;StorageObjectFullName,&amp;UploadedFile,11)  

msg(&amp;UploadedFile.GetURI(), status) //URL is valid during 11 minutes</pre>

<div style="background-color: rgb(221,255,221);border-left: 6.0px solid rgb(76,175,80);">
<p>Download the complete sample from <a href="https://wiki.genexus.com/commwiki/wiki?32102,," target="_blank">Storage provider API sample</a>.</p>
</div>

<h2><a id="Change+the+Storage+Provider+at+runtime" class="HashLink" href="#Change+the+Storage+Provider+at+runtime">Change the Storage Provider at runtime</a></h2>

<p>See <a href="45913.html">Configuration.ExternalStorage External Object</a>.</p>

<h2><a id="Availability" class="HashLink" href="#Availability">Availability</a></h2>

<p>The Storage Provider API is available for Java and .NET Generators and all Storage providers supported by the <a href="31121.html">Storage Provider property</a>.<br />
<em>Exception</em>: UploadPrivate and GetPrivate are available only for .NET Generator and Amazon S3 since <a href="https://wiki.genexus.com/commwiki/wiki?33278,," target="_blank">GeneXus 15 Upgrade 3</a>. They are available for .NET Generator and Java Generators for Amazon S3 and Microsoft Azure since <a href="https://wiki.genexus.com/commwiki/wiki?36355,," target="_blank">GeneXus 15 Upgrade 7</a>. These methods will be available for the rest of platforms in the upcoming upgrades.</p>

<p><br />
</p>
<br />
<br />
</td></tr></tbody></table><script src="./images/run_prettify.js?lang=genexus"></script><hr /><table id="Pages" class="Table" cellpadding="1" cellspacing="2" style=" width: 100%;" ><TR><TD><b>Backlinks</b></TD></TR><TR><TD><a href="45913.html">Configuration.ExternalStorage External Object</a></TD><TD><a href="6567.html">Directory data type</a></TD></TR><TR><TD><a href="31120.html">External Storage for Multimedia</a></TD><TD><a href="6915.html">File data type</a></TD></TR><TR><TD><a href="45291.html">Load balancing considerations</a></TD><TD><a href="31121.html">Storage Provider property</a></TD></TR><TR></TR></table>
</span></body>
</html><hr /><table id="Pages" class="Table" cellpadding="1" cellspacing="2" style=" width: 100%;" ><TR><td align="left"><font face="Verdana" size="1"><em>Source: <a href="https://wiki.genexus.com" target=_blank>wiki.genexus.com</a></em></font></td><td align="right"><font face="Verdana" size="1"><em>Last modification: 06/01/21 09:48 PM</em></font></td></TR></table></font>